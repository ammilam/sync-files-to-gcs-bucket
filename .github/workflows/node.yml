name: Node.js CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16.x'

      - run: npm ci
      - run: npm install pkg -g
      - run: pkg .

  create-tag:
    needs: build
    runs-on: ubuntu-latest
    container:
      image: alpine/git
    steps:
    - uses: actions/checkout@v2

    - uses: actions-ecosystem/action-get-latest-tag@v1
      id: get-latest-tag

    - uses: actions-ecosystem/action-bump-semver@v1
      id: bump-semver
      with:
        current_version: ${{ steps.get-latest-tag.outputs.tag }}
        level: minor

    - uses: actions-ecosystem/action-push-tag@v1
      with:
        tag: ${{ steps.bump-semver.outputs.new_version }}
        message: '${{ steps.bump-semver.outputs.new_version }}: PR #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}'

  # release:
  #   name: "Release"
  #   needs: create-tag
  #   runs-on: "ubuntu-latest"
  #   steps:
  #     - name: "Create release"
  #       uses: "actions/github-script@v5"
  #       with:
  #         github-token: "${{ secrets.GITHUB_TOKEN }}"
  #         script: |
  #           try {
  #             await github.rest.repos.createRelease({
  #               draft: false,
  #               generate_release_notes: true,
  #               name: ${{ needs.create-tag.outputs.new_tag }},
  #               owner: context.repo.owner,
  #               prerelease: false,
  #               repo: context.repo.repo,
  #               tag_name: ${{ needs.create-tag.outputs.new_tag }},
  #             });
  #           } catch (error) {
  #             core.setFailed(error);
  #           }

